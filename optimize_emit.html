<!DOCTYPE html>
<html class="writer-html5" lang="en">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Optimize Scope 2 Emissions &mdash; EEC 0.0.4 documentation</title>
      <link rel="stylesheet" type="text/css" href="_static/pygments.css" />
      <link rel="stylesheet" type="text/css" href="_static/css/theme.css" />
      <link rel="stylesheet" type="text/css" href="_static/css/custom.css" />

  
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="_static/jquery.js"></script>
        <script src="_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
        <script src="_static/doctools.js"></script>
        <script src="_static/sphinx_highlight.js"></script>
    <script src="_static/js/theme.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Co-optimize Costs and Emissions" href="cooptimize.html" />
    <link rel="prev" title="Optimize Electricity Costs" href="optimize_cost.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="index.html" class="icon icon-home">
            EEC
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Overview</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="index.html">Table of Contents</a></li>
<li class="toctree-l1"><a class="reference internal" href="purpose.html">What is the Purpose of this Package?</a></li>
<li class="toctree-l1"><a class="reference internal" href="hello.html">Getting Started</a></li>
<li class="toctree-l1"><a class="reference internal" href="complexities.html">What Makes Electricity Tariffs so Complex?</a></li>
<li class="toctree-l1"><a class="reference internal" href="why_metrics.html">Why Use Flexibility Metrics?</a></li>
<li class="toctree-l1"><a class="reference internal" href="why_neutral.html">Why Design a Pyomo/CVXPY Neutral Library?</a></li>
<li class="toctree-l1"><a class="reference internal" href="why_advanced.html">Why Do the Advanced Features Exist?</a></li>
<li class="toctree-l1"><a class="reference internal" href="CONTRIBUTING.html">Contributing</a></li>
<li class="toctree-l1"><a class="reference internal" href="LICENSE.html">MIT License</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Tutorials</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="optimize_cost.html">Optimize Electricity Costs</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Optimize Scope 2 Emissions</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#cvxpy">CVXPY</a></li>
<li class="toctree-l2"><a class="reference internal" href="#pyomo">Pyomo</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="cooptimize.html">Co-optimize Costs and Emissions</a></li>
<li class="toctree-l1"><a class="reference internal" href="tutorial_metrics.html">Flexibility Metrics as Constraints</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">How-to Guides</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="data_format.html">Data Formats</a></li>
<li class="toctree-l1"><a class="reference internal" href="how_to_cost.html">How to Calculate Costs</a></li>
<li class="toctree-l1"><a class="reference internal" href="how_to_emit.html">How to Calculate Emissions</a></li>
<li class="toctree-l1"><a class="reference internal" href="how_to_metrics.html">How to Use Flexibility Metrics</a></li>
<li class="toctree-l1"><a class="reference internal" href="how_to_advanced.html">How to Use Advanced Features</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Code</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="costs.html">costs</a></li>
<li class="toctree-l1"><a class="reference internal" href="emissions.html">emissions</a></li>
<li class="toctree-l1"><a class="reference internal" href="metrics.html">metrics</a></li>
<li class="toctree-l1"><a class="reference internal" href="units.html">units</a></li>
<li class="toctree-l1"><a class="reference internal" href="utils.html">utils</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">EEC</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="index.html" class="icon icon-home" aria-label="Home"></a></li>
      <li class="breadcrumb-item active">Optimize Scope 2 Emissions</li>
      <li class="wy-breadcrumbs-aside">
            <a href="_sources/optimize_emit.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <nav class="contents" id="contents" role="doc-toc">
<p class="topic-title">Contents</p>
<ul class="simple">
<li><p><a class="reference internal" href="#optimize-scope-2-emissions" id="id8">Optimize Scope 2 Emissions</a></p>
<ul>
<li><p><a class="reference internal" href="#cvxpy" id="id9">CVXPY</a></p></li>
<li><p><a class="reference internal" href="#pyomo" id="id10">Pyomo</a></p></li>
</ul>
</li>
</ul>
</nav>
<section id="optimize-scope-2-emissions">
<span id="tutorial-emit"></span><h1><a class="toc-backref" href="#id8" role="doc-backlink">Optimize Scope 2 Emissions</a><a class="headerlink" href="#optimize-scope-2-emissions" title="Permalink to this heading"></a></h1>
<p>This tutorial will walk through how to optimize Scope 2 emissions for a simple battery model in either <a class="reference internal" href="#cvx-emit"><span class="std std-ref">CVXPY</span></a> or <a class="reference internal" href="#pyo-emit"><span class="std std-ref">Pyomo</span></a> by going through the following steps:</p>
<blockquote>
<div><ol class="arabic simple">
<li><p>Load a Scope 2 emissions spreadsheet</p></li>
<li><p>Configure an optimization model of the electricity consumer with system constraints</p>
<ul class="simple">
<li><p>Consider using flexibility metrics to encode system constraints (<a class="reference internal" href="tutorial_metrics.html#tutorial-metrics"><span class="std std-ref">Flexibility Metrics as Constraints</span></a>)!</p></li>
<li><p>The models are presented step-by-step to demonstrate the model-building process,
but the complete models are available in the <cite>examples</cite> folder:</p>
<ul>
<li><p><a class="reference external" href="https://github.com/we3lab/electric-emission-cost/blob/main/examples/pyomo_battery_model.py">pyomo_battery_model.py</a></p></li>
<li><p><a class="reference external" href="https://github.com/we3lab/electric-emission-cost/blob/main/examples/cvxpy_battery_model.py">cvxpy_battery_model.py</a></p></li>
</ul>
</li>
</ul>
</li>
<li><p>Create an objective function of Scope 2 emissions using the emissions factors</p></li>
<li><p>Minimize the Scope 2 emissions of this consumer, given the system constraints and base load consumption</p></li>
<li><p>Display the results to validate that the optimization is correct</p></li>
</ol>
</div></blockquote>
<section id="cvxpy">
<span id="cvx-emit"></span><h2><a class="toc-backref" href="#id9" role="doc-backlink">CVXPY</a><a class="headerlink" href="#cvxpy" title="Permalink to this heading"></a></h2>
<ol class="arabic simple" start="0">
<li><p>Import dependencies</p></li>
</ol>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">datetime</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">cvxpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">cp</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">pandas</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">pd</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">matplotlib.pyplot</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">plt</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">electric_emission_cost.units</span><span class="w"> </span><span class="kn">import</span> <span class="n">u</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">electric_emission_cost</span><span class="w"> </span><span class="kn">import</span> <span class="n">emissions</span>
</pre></div>
</div>
<ol class="arabic simple">
<li><p>Load a Scope 2 emissions spreadsheet</p></li>
</ol>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">path_to_emissions_sheet</span> <span class="o">=</span> <span class="s2">&quot;electric_emission_cost/data/emissions.csv&quot;</span>
<span class="n">emission_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">path_to_emissions_sheet</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="s2">&quot;,&quot;</span><span class="p">)</span>

<span class="c1"># get the charge dictionary</span>
<span class="n">carbon_intensity</span> <span class="o">=</span> <span class="n">emissions</span><span class="o">.</span><span class="n">get_carbon_intensity</span><span class="p">(</span>
    <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="p">(</span><span class="mi">2023</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">9</span><span class="p">),</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="p">(</span><span class="mi">2023</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">11</span><span class="p">),</span> <span class="n">emission_df</span><span class="p">,</span> <span class="n">resolution</span><span class="o">=</span><span class="s2">&quot;1m&quot;</span>
<span class="p">)</span>
</pre></div>
</div>
<p>We are going to evaluate the electricity consumption from only April 9th to April 10th since that is where our
synthetic data comes from (<a class="reference external" href="https://github.com/we3lab/electric-emission-cost/blob/main/electric_emission_cost/data/consumption.csv">https://github.com/we3lab/electric-emission-cost/blob/main/electric_emission_cost/data/consumption.csv</a>).
You will also see that it is in 1-minute intervals, hence <cite>resolution=”1m”</cite>.</p>
<ol class="arabic simple" start="2">
<li><p>Configure an optimization model of the electricity consumer with system constraints</p></li>
</ol>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># load historical consumption data</span>
<span class="n">load_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s2">&quot;electric_emission_cost/data/consumption.csv&quot;</span><span class="p">,</span> <span class="n">parse_dates</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;Datetime&quot;</span><span class="p">])</span>

<span class="c1"># set battery parameters</span>
<span class="c1"># create variables for battery total energy, max charge and discharge power, and SOC limits</span>
<span class="n">total_capacity</span> <span class="o">=</span> <span class="mi">10</span> <span class="c1"># kWh</span>
<span class="n">min_soc</span> <span class="o">=</span> <span class="mi">0</span>
<span class="n">max_soc</span> <span class="o">=</span> <span class="mi">1</span>
<span class="n">init_soc</span> <span class="o">=</span> <span class="mf">0.5</span>
<span class="n">fin_soc</span> <span class="o">=</span> <span class="mf">0.5</span>
<span class="n">max_discharge</span> <span class="o">=</span> <span class="mi">5</span> <span class="c1"># kW</span>
<span class="n">max_charge</span> <span class="o">=</span> <span class="mi">5</span> <span class="c1"># kW</span>
<span class="n">T</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">load_df</span><span class="p">[</span><span class="s2">&quot;Datetime&quot;</span><span class="p">])</span>
<span class="n">delta_t</span> <span class="o">=</span> <span class="p">((</span><span class="n">load_df</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="s2">&quot;Datetime&quot;</span><span class="p">]</span> <span class="o">-</span> <span class="n">load_df</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s2">&quot;Datetime&quot;</span><span class="p">])</span> <span class="o">/</span> <span class="n">T</span><span class="p">)</span> <span class="o">/</span> <span class="n">datetime</span><span class="o">.</span><span class="n">timedelta</span><span class="p">(</span><span class="n">hours</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

<span class="c1"># initialize variables</span>
<span class="n">battery_output_kW</span> <span class="o">=</span> <span class="n">cp</span><span class="o">.</span><span class="n">Variable</span><span class="p">(</span><span class="n">T</span><span class="p">)</span>
<span class="n">battery_soc</span> <span class="o">=</span> <span class="n">cp</span><span class="o">.</span><span class="n">Variable</span><span class="p">(</span><span class="n">T</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
<span class="n">grid_demand_kW</span> <span class="o">=</span> <span class="n">cp</span><span class="o">.</span><span class="n">Variable</span><span class="p">(</span><span class="n">T</span><span class="p">)</span>

<span class="c1"># set constraints</span>
<span class="n">constraints</span> <span class="o">=</span> <span class="p">[</span>
    <span class="n">battery_output_kW</span> <span class="o">&gt;=</span> <span class="o">-</span><span class="n">max_discharge</span><span class="p">,</span>
    <span class="n">battery_output_kW</span> <span class="o">&lt;=</span> <span class="n">max_charge</span><span class="p">,</span>
    <span class="n">battery_soc</span> <span class="o">&gt;=</span> <span class="n">min_soc</span><span class="p">,</span>
    <span class="n">battery_soc</span> <span class="o">&lt;=</span> <span class="n">max_soc</span><span class="p">,</span>
    <span class="n">battery_soc</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="n">init_soc</span><span class="p">,</span>
    <span class="n">battery_soc</span><span class="p">[</span><span class="n">T</span><span class="p">]</span> <span class="o">==</span> <span class="n">fin_soc</span><span class="p">,</span>
    <span class="n">grid_demand_kW</span> <span class="o">&gt;=</span> <span class="mi">0</span>
<span class="p">]</span>
<span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">T</span><span class="p">):</span>
    <span class="n">constraints</span> <span class="o">+=</span> <span class="p">[</span>
        <span class="n">battery_soc</span><span class="p">[</span><span class="n">t</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="n">battery_soc</span><span class="p">[</span><span class="n">t</span><span class="p">]</span> <span class="o">+</span> <span class="p">(</span><span class="n">battery_output_kW</span><span class="p">[</span><span class="n">t</span><span class="p">]</span> <span class="o">*</span> <span class="n">delta_t</span><span class="p">)</span> <span class="o">/</span> <span class="n">total_capacity</span><span class="p">,</span>
        <span class="n">grid_demand_kW</span><span class="p">[</span><span class="n">t</span><span class="p">]</span> <span class="o">==</span> <span class="n">load_df</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">t</span><span class="p">][</span><span class="s2">&quot;Load [kW]&quot;</span><span class="p">]</span> <span class="o">+</span> <span class="n">battery_output_kW</span><span class="p">[</span><span class="n">t</span><span class="p">]</span>
    <span class="p">]</span>
</pre></div>
</div>
<p>This is a standard battery model with energy (i.e., total charge) and power (i.e., discharge/charge rate) constraints.
The round-trip efficiency is 1.0 since there is no penalty applied when discharging the battery,
but that’s fine for these demonstration purposes.</p>
<ol class="arabic simple" start="3">
<li><p>Create an objective function of Scope 2 emissions using the emissions factors</p></li>
</ol>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># NOTE: second entry of the tuple can be ignored since it&#39;s for Pyomo</span>
<span class="n">obj</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">emissions</span><span class="o">.</span><span class="n">calculate_grid_emissions</span><span class="p">(</span>
    <span class="n">carbon_intensity</span><span class="p">,</span>
    <span class="n">grid_demand_kW</span><span class="p">,</span>
    <span class="n">resolution</span><span class="o">=</span><span class="s2">&quot;1m&quot;</span><span class="p">,</span>
    <span class="n">consumption_units</span><span class="o">=</span><span class="n">u</span><span class="o">.</span><span class="n">kW</span>
<span class="p">)</span>
</pre></div>
</div>
<p>There is also an optional <cite>emissions_units</cite> argument that we do not use in the above example.
That is because <cite>get_carbon_intensity</cite> returns a <cite>pint.Quantity</cite> from which we can automatically parse the emissions units.</p>
<ol class="arabic simple" start="4">
<li><p>Minimize the Scope 2 emissions of this consumer, given the system constraints and base load consumption</p></li>
</ol>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># solve the CVX problem (objective variable should be named obj)</span>
<span class="n">prob</span> <span class="o">=</span> <span class="n">cp</span><span class="o">.</span><span class="n">Problem</span><span class="p">(</span><span class="n">cp</span><span class="o">.</span><span class="n">Minimize</span><span class="p">(</span><span class="n">obj</span><span class="p">),</span> <span class="n">constraints</span><span class="p">)</span>
<span class="n">prob</span><span class="o">.</span><span class="n">solve</span><span class="p">()</span>
</pre></div>
</div>
<ol class="arabic simple" start="5">
<li><p>Display the results to validate that the optimization is correct</p></li>
</ol>
<p>We will compare baseline to optimized emissions.
Unlike <a class="reference internal" href="optimize_cost.html#tutorial-cost"><span class="std std-ref">Optimize Electricity Costs</span></a>, there are no convex relaxations during problem formulation, so the objective function can be used directly to quantify emissions.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># NOTE: second entry of the tuple can be ignored since it&#39;s for Pyomo</span>
<span class="n">baseline_emissions</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">emissions</span><span class="o">.</span><span class="n">calculate_grid_emissions</span><span class="p">(</span>
    <span class="n">carbon_intensity</span><span class="p">,</span>
    <span class="n">load_df</span><span class="p">[</span><span class="s2">&quot;Load [kW]&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">,</span>
    <span class="n">resolution</span><span class="o">=</span><span class="s2">&quot;1m&quot;</span><span class="p">,</span>
    <span class="n">consumption_units</span><span class="o">=</span><span class="n">u</span><span class="o">.</span><span class="n">kW</span>
<span class="p">)</span>
<span class="c1"># NOTE: second entry of the tuple can be ignored since it&#39;s for Pyomo</span>
<span class="n">optimized_emissions</span> <span class="o">=</span> <span class="n">obj</span><span class="o">.</span><span class="n">value</span>
</pre></div>
</div>
<p>If we print our results, we confirm that the optimal electricity profile has emissions of
9.74 kg CO:sub:<cite>2</cite>-eq, 0.95 kg CO:sub:<cite>2</cite>-eq less than the baseline emissions of 10.69 kg CO:sub:<cite>2</cite>-eq.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="go">&gt;&gt;&gt;print(f&quot;Baseline Scope 2 Emissions: {baseline_emissions:.2f} kg CO_2-eq&quot;)</span>
<span class="go">Baseline Scope 2 Emissions: 10.69 kilogram kg CO_2-eq</span>
<span class="go">&gt;&gt;&gt;print(f&quot;Optimized Scope 2 Emissions: {optimized_emissions:.2f} kg CO_2-eq&quot;)</span>
<span class="go">Optimized Scope 2 Emissions: 9.74 kilogram kg CO_2-eq</span>
</pre></div>
</div>
<p>Below are a few simple plots to validate our results.
First, we visualize the emissions factors:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span>

<span class="c1"># plot the emissions factors</span>
<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">load_df</span><span class="p">[</span><span class="s2">&quot;Datetime&quot;</span><span class="p">],</span> <span class="n">carbon_intensity</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">u</span><span class="o">.</span><span class="n">kg</span> <span class="o">/</span> <span class="n">u</span><span class="o">.</span><span class="n">MWh</span><span class="p">))</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set</span><span class="p">(</span>
    <span class="n">xlabel</span><span class="o">=</span><span class="s2">&quot;DateTime&quot;</span><span class="p">,</span>
    <span class="n">ylabel</span><span class="o">=</span><span class="s2">&quot;Carbon Intensity (kg CO$_2$ / MWh)&quot;</span><span class="p">,</span>
    <span class="n">xlim</span><span class="o">=</span><span class="p">(</span><span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="p">(</span><span class="mi">2023</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">9</span><span class="p">),</span>
    <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="p">(</span><span class="mi">2023</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">11</span><span class="p">)),</span>
    <span class="n">ylim</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">500</span><span class="p">]</span>
<span class="p">)</span>

<span class="n">fig</span><span class="o">.</span><span class="n">align_ylabels</span><span class="p">()</span>
<span class="n">fig</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">fig</span><span class="o">.</span><span class="n">suptitle</span><span class="p">(</span><span class="s2">&quot;Scope 2 Emissions Factors&quot;</span><span class="p">,</span><span class="n">y</span><span class="o">=</span><span class="mf">1.02</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
<figure class="align-default" id="id2">
<img alt="_images/cvx-carbon-intensity.png" src="_images/cvx-carbon-intensity.png" />
<figcaption>
<p><span class="caption-text">Average Scope 2 emissions factors for our modeling period (April 9-10, 2023).</span><a class="headerlink" href="#id2" title="Permalink to this image"></a></p>
</figcaption>
</figure>
<p>Next, we plot the baseline and optimal electricity consumption profiles.
This helps us to visualize how the model responds to the cost incentives of the tariff.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># plot the model outputs</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span>
<span class="n">ax</span><span class="o">.</span><span class="n">step</span><span class="p">(</span><span class="n">load_df</span><span class="p">[</span><span class="s2">&quot;Datetime&quot;</span><span class="p">],</span> <span class="n">grid_demand_kW</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;C0&quot;</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Net Load&quot;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">step</span><span class="p">(</span><span class="n">load_df</span><span class="p">[</span><span class="s2">&quot;Datetime&quot;</span><span class="p">],</span> <span class="n">load_df</span><span class="p">[</span><span class="s2">&quot;Load [kW]&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;k&quot;</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Baseload&quot;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">xlabel</span><span class="o">=</span><span class="s2">&quot;DateTime&quot;</span><span class="p">,</span> <span class="n">ylabel</span><span class="o">=</span><span class="s2">&quot;Power (kW)&quot;</span><span class="p">,</span> <span class="n">xlim</span><span class="o">=</span><span class="p">(</span><span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="p">(</span><span class="mi">2023</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">9</span><span class="p">),</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="p">(</span><span class="mi">2023</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">11</span><span class="p">)))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">(</span><span class="n">rotation</span><span class="o">=</span><span class="mi">45</span><span class="p">)</span>
<span class="n">fig</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
<figure class="align-default" id="id3">
<img alt="_images/cvx-emit-model-out.png" src="_images/cvx-emit-model-out.png" />
<figcaption>
<p><span class="caption-text">Output of our electricity bill optimization using the virtual battery model.
The dotted line is baseline electricity purchases, and the blue line is the optimized profile.
Note how the optimized electricity profile shaves peaks to readuce time-of-use (TOU) charges</span><a class="headerlink" href="#id3" title="Permalink to this image"></a></p>
</figcaption>
</figure>
<p>Finally, let’s plot the battery state of charge (SOC) to confirm that the constraints were respected:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># plot the battery charge</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span>
<span class="n">ax</span><span class="o">.</span><span class="n">step</span><span class="p">(</span><span class="n">load_df</span><span class="p">[</span><span class="s2">&quot;Datetime&quot;</span><span class="p">],</span> <span class="n">battery_soc</span><span class="o">.</span><span class="n">value</span><span class="p">[</span><span class="mi">1</span><span class="p">:],</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;C1&quot;</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Battery SOC&quot;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set</span><span class="p">(</span>
    <span class="n">xlabel</span><span class="o">=</span><span class="s2">&quot;Time&quot;</span><span class="p">,</span>
    <span class="n">ylabel</span><span class="o">=</span><span class="s2">&quot;Battery SOC&quot;</span><span class="p">,</span>
    <span class="n">ylim</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">],</span>
    <span class="n">xlim</span><span class="o">=</span><span class="p">(</span><span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="p">(</span><span class="mi">2023</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">9</span><span class="p">),</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="p">(</span><span class="mi">2023</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">11</span><span class="p">))</span>
<span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">(</span><span class="n">rotation</span><span class="o">=</span><span class="mi">45</span><span class="p">)</span>
<span class="n">fig</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
</pre></div>
</div>
<figure class="align-default" id="id4">
<img alt="_images/cvx-emit-battery-soc.png" src="_images/cvx-emit-battery-soc.png" />
<figcaption>
<p><span class="caption-text">Battery state of charge (SOC) as a percentage during our modeling period (April 9-10, 2023).</span><a class="headerlink" href="#id4" title="Permalink to this image"></a></p>
</figcaption>
</figure>
</section>
<section id="pyomo">
<span id="pyo-emit"></span><h2><a class="toc-backref" href="#id10" role="doc-backlink">Pyomo</a><a class="headerlink" href="#pyomo" title="Permalink to this heading"></a></h2>
<ol class="arabic simple" start="0">
<li><p>Import dependencies</p></li>
</ol>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">datetime</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">pandas</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">pd</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">matplotlib.pyplot</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">plt</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">electric_emission_cost.units</span><span class="w"> </span><span class="kn">import</span> <span class="n">u</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">electric_emission_cost</span><span class="w"> </span><span class="kn">import</span> <span class="n">emissions</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">examples.pyomo_battery_model</span><span class="w"> </span><span class="kn">import</span> <span class="n">BatteryPyomo</span>
</pre></div>
</div>
<ol class="arabic simple">
<li><p>Load a Scope 2 emissions spreadsheet</p></li>
</ol>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">path_to_emissions_sheet</span> <span class="o">=</span> <span class="s2">&quot;electric_emission_cost/data/emissions.csv&quot;</span>
<span class="n">emission_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">path_to_emissions_sheet</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="s2">&quot;,&quot;</span><span class="p">)</span>

<span class="c1"># get the charge dictionary</span>
<span class="n">carbon_intensity</span> <span class="o">=</span> <span class="n">emissions</span><span class="o">.</span><span class="n">get_carbon_intensity</span><span class="p">(</span>
    <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="p">(</span><span class="mi">2022</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="p">(</span><span class="mi">2022</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="n">emission_df</span><span class="p">,</span> <span class="n">resolution</span><span class="o">=</span><span class="s2">&quot;15m&quot;</span>
<span class="p">)</span>
</pre></div>
</div>
<p>We are going to evaluate the electricity consumption for the entire month of July 2022.
Below, we will create synthetic <cite>baseload</cite> data for this month with 15-minute resolution, so <cite>resolution=”15m”</cite>.</p>
<ol class="arabic simple" start="2">
<li><p>Configure an optimization model of the electricity consumer with system constraints</p></li>
</ol>
<p>We rely on the virtual battery model in <a class="reference external" href="https://github.com/we3lab/electric-emission-cost/blob/main/examples/pyomo_battery_model.py">pyomo_battery_model.py</a>.
We’re going to stick to the electricity cost calculation details, but we encourage you to go check out the code to better understand the model.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Define the parameters for the battery model</span>
<span class="n">battery_params</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;start_date&quot;</span><span class="p">:</span> <span class="s2">&quot;2022-07-01 00:00:00&quot;</span><span class="p">,</span>
    <span class="s2">&quot;end_date&quot;</span><span class="p">:</span> <span class="s2">&quot;2022-08-01 00:00:00&quot;</span><span class="p">,</span>
    <span class="s2">&quot;timestep&quot;</span><span class="p">:</span> <span class="mf">0.25</span><span class="p">,</span>   <span class="c1"># 15 minutes defined in hours</span>
    <span class="s2">&quot;rte&quot;</span><span class="p">:</span> <span class="mf">0.86</span><span class="p">,</span>
    <span class="s2">&quot;energycapacity&quot;</span><span class="p">:</span> <span class="mi">100</span><span class="p">,</span>
    <span class="s2">&quot;powercapacity&quot;</span><span class="p">:</span> <span class="mi">50</span><span class="p">,</span>
    <span class="s2">&quot;soc_min&quot;</span><span class="p">:</span> <span class="mf">0.05</span><span class="p">,</span>
    <span class="s2">&quot;soc_max&quot;</span><span class="p">:</span> <span class="mf">0.95</span><span class="p">,</span>
    <span class="s2">&quot;soc_init&quot;</span><span class="p">:</span> <span class="mf">0.5</span><span class="p">,</span>
<span class="p">}</span>

<span class="c1"># Create a sample baseload profile based on a sine wave</span>
<span class="n">baseload</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">4</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">,</span> <span class="mi">96</span><span class="p">))</span><span class="o">*</span><span class="mi">100</span> <span class="o">+</span> <span class="mi">1000</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">normal</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">96</span><span class="p">)</span>

<span class="c1"># Create an instance of the BatteryOpt class</span>
<span class="n">battery</span> <span class="o">=</span> <span class="n">BatteryPyomo</span><span class="p">(</span><span class="n">battery_params</span><span class="p">,</span> <span class="n">baseload</span><span class="p">,</span> <span class="n">baseload_repeat</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="c1"># create the model on the instance battery</span>
<span class="n">battery</span><span class="o">.</span><span class="n">create_model</span><span class="p">()</span>
</pre></div>
</div>
<p>The above code initializes the battery model with flexibility metrics like round-trip efficiency (RTE),
power capacity, and energy capacity.</p>
<ol class="arabic simple" start="3">
<li><p>Create an objective function of Scope 2 emissions using the emissions factors</p></li>
</ol>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># compute Scope 2 emissions using Pyomo variable</span>
<span class="n">battery</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">emissions</span><span class="p">,</span> <span class="n">battery</span><span class="o">.</span><span class="n">model</span> <span class="o">=</span> <span class="n">emissions</span><span class="o">.</span><span class="n">calculate_grid_emissions</span><span class="p">(</span>
    <span class="n">carbon_intensity</span><span class="p">,</span>
    <span class="n">battery</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">net_facility_load</span><span class="p">,</span>
    <span class="n">resolution</span><span class="o">=</span><span class="s2">&quot;15m&quot;</span><span class="p">,</span>
    <span class="n">consumption_units</span><span class="o">=</span><span class="n">u</span><span class="o">.</span><span class="n">kW</span><span class="p">,</span>
    <span class="n">model</span><span class="o">=</span><span class="n">battery</span><span class="o">.</span><span class="n">model</span>
<span class="p">)</span>
<span class="c1"># create an attribute objective based on the emissions</span>
<span class="n">battery</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">objective</span> <span class="o">=</span> <span class="n">pyo</span><span class="o">.</span><span class="n">Objective</span><span class="p">(</span>
    <span class="n">expr</span><span class="o">=</span><span class="n">battery</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">emissions</span><span class="p">,</span>
    <span class="n">sense</span><span class="o">=</span><span class="n">pyo</span><span class="o">.</span><span class="n">minimize</span><span class="p">,</span>
<span class="p">)</span>
</pre></div>
</div>
<ol class="arabic simple" start="4">
<li><p>Minimize the Scope 2 emissions of this consumer given the system constraints and base load consumption</p></li>
</ol>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># use the glpk solver to solve the model - (any pyomo-supported LP solver will work here)</span>
<span class="n">solver</span> <span class="o">=</span> <span class="n">pyo</span><span class="o">.</span><span class="n">SolverFactory</span><span class="p">(</span><span class="s2">&quot;glpk&quot;</span><span class="p">)</span>
<span class="n">results</span> <span class="o">=</span> <span class="n">solver</span><span class="o">.</span><span class="n">solve</span><span class="p">(</span><span class="n">battery</span><span class="o">.</span><span class="n">model</span><span class="p">,</span> <span class="n">tee</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span> <span class="c1"># turn tee=True to see solver output</span>
</pre></div>
</div>
<ol class="arabic simple" start="5">
<li><p>Display the results to validate that the optimization is correct</p></li>
</ol>
<p>We will compare baseline to optimized emissions.
Unlike <a class="reference internal" href="optimize_cost.html#tutorial-cost"><span class="std std-ref">Optimize Electricity Costs</span></a>, there are no convex relaxations during problem formulation, so the objective function can be used directly to quantify emissions.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># retrieve outputs from Pyomo model</span>
<span class="n">net_load</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">battery</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">net_facility_load</span><span class="p">[</span><span class="n">t</span><span class="p">]</span><span class="o">.</span><span class="n">value</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">battery</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">t</span><span class="p">])</span>
<span class="n">baseload</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">battery</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">baseload</span><span class="p">[</span><span class="n">t</span><span class="p">]</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">battery</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">t</span><span class="p">])</span>

<span class="c1"># NOTE: second entry of the tuple can be ignored since it&#39;s for Pyomo</span>
<span class="n">baseline_emissions</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">emissions</span><span class="o">.</span><span class="n">calculate_grid_emissions</span><span class="p">(</span>
    <span class="n">carbon_intensity</span><span class="p">,</span>
    <span class="n">baseload</span><span class="p">,</span>
    <span class="n">resolution</span><span class="o">=</span><span class="s2">&quot;15m&quot;</span><span class="p">,</span>
    <span class="n">consumption_units</span><span class="o">=</span><span class="n">u</span><span class="o">.</span><span class="n">kW</span>
<span class="p">)</span>
<span class="c1"># NOTE: second entry of the tuple can be ignored since it&#39;s for Pyomo</span>
<span class="n">optimized_emissions</span> <span class="o">=</span> <span class="n">pyo</span><span class="o">.</span><span class="n">value</span><span class="p">(</span><span class="n">battery</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">objective</span><span class="p">)</span>
</pre></div>
</div>
<p>If we print our results, we confirm that the optimal electricity profile has emissions of
9.74 kg CO:sub:<cite>2</cite>-eq, 0.95 kg CO:sub:<cite>2</cite>-eq less than the baseline emissions of 10.69 kg CO:sub:<cite>2</cite>-eq.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="go">&gt;&gt;&gt;print(f&quot;Baseline Scope 2 Emissions: {baseline_emissions:.2f} kg CO_2-eq&quot;)</span>
<span class="go">Baseline Scope 2 Emissions: 276673.42 kilogram kg CO_2-eq</span>
<span class="go">&gt;&gt;&gt;print(f&quot;Optimized Scope 2 Emissions: {optimized_emissions:.2f} kg CO_2-eq&quot;)</span>
<span class="go">Optimized Scope 2 Emissions: 276416.54 kilogram kg CO_2-eq</span>
</pre></div>
</div>
<p>Below are a few simple plots to validate our results.
First, we visualize the emissions factors:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span>

<span class="c1"># plot the emissions factors</span>
<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">battery</span><span class="o">.</span><span class="n">t</span><span class="p">,</span> <span class="n">carbon_intensity</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">u</span><span class="o">.</span><span class="n">kg</span> <span class="o">/</span> <span class="n">u</span><span class="o">.</span><span class="n">MWh</span><span class="p">))</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set</span><span class="p">(</span>
    <span class="n">xlabel</span><span class="o">=</span><span class="s2">&quot;DateTime&quot;</span><span class="p">,</span>
    <span class="n">ylabel</span><span class="o">=</span><span class="s2">&quot;Carbon Intensity (kg CO$_2$ / MWh)&quot;</span><span class="p">,</span>
    <span class="n">xlim</span><span class="o">=</span><span class="p">(</span><span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="p">(</span><span class="mi">2022</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
    <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="p">(</span><span class="mi">2022</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">1</span><span class="p">)),</span>
    <span class="n">ylim</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">500</span><span class="p">]</span>
<span class="p">)</span>

<span class="n">fig</span><span class="o">.</span><span class="n">align_ylabels</span><span class="p">()</span>
<span class="n">fig</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">fig</span><span class="o">.</span><span class="n">suptitle</span><span class="p">(</span><span class="s2">&quot;Scope 2 Emissions Factors&quot;</span><span class="p">,</span><span class="n">y</span><span class="o">=</span><span class="mf">1.02</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
<figure class="align-default" id="id5">
<img alt="_images/pyo-carbon-intensity.png" src="_images/pyo-carbon-intensity.png" />
<figcaption>
<p><span class="caption-text">Average Scope 2 emissions factors for our modeling period (July 2022).</span><a class="headerlink" href="#id5" title="Permalink to this image"></a></p>
</figcaption>
</figure>
<p>Next, we plot the baseline and optimal electricity consumption profiles.
This helps us to visualize how the model responds to the cost incentives of the tariff.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># plot the model outputs</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span>
<span class="n">ax</span><span class="o">.</span><span class="n">step</span><span class="p">(</span><span class="n">battery</span><span class="o">.</span><span class="n">t</span><span class="p">,</span> <span class="n">net_load</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;C0&quot;</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Net Load&quot;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">step</span><span class="p">(</span><span class="n">battery</span><span class="o">.</span><span class="n">t</span><span class="p">,</span> <span class="n">baseload</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;k&quot;</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Baseload&quot;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">xlabel</span><span class="o">=</span><span class="s2">&quot;DateTime&quot;</span><span class="p">,</span> <span class="n">ylabel</span><span class="o">=</span><span class="s2">&quot;Power (kW)&quot;</span><span class="p">,</span> <span class="n">xlim</span><span class="o">=</span><span class="p">(</span><span class="n">battery</span><span class="o">.</span><span class="n">start_dt</span><span class="p">,</span> <span class="n">battery</span><span class="o">.</span><span class="n">end_dt</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">(</span><span class="n">rotation</span><span class="o">=</span><span class="mi">45</span><span class="p">)</span>
<span class="n">fig</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
</pre></div>
</div>
<figure class="align-default" id="id6">
<img alt="_images/pyo-emit-model-out.png" src="_images/pyo-emit-model-out.png" />
<figcaption>
<p><span class="caption-text">Output of our electricity bill optimization using the virtual battery model.
The dotted line is baseline electricity purchases, and the blue line is the optimized profile.
Note how the optimized electricity profile shaves peaks to readuce time-of-use (TOU) charges</span><a class="headerlink" href="#id6" title="Permalink to this image"></a></p>
</figcaption>
</figure>
<p>Finally, let’s plot the battery state of charge (SOC) to confirm that the constraints were respected:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># plot the battery charge</span>
<span class="n">battery_charge</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">battery</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">soc</span><span class="p">[</span><span class="n">t</span><span class="p">]</span><span class="o">.</span><span class="n">value</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">battery</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">t</span><span class="p">])</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span>
<span class="n">ax</span><span class="o">.</span><span class="n">step</span><span class="p">(</span><span class="n">battery</span><span class="o">.</span><span class="n">t</span><span class="p">,</span> <span class="n">battery_charge</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;C1&quot;</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Battery SOC&quot;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">xlabel</span><span class="o">=</span><span class="s2">&quot;Time&quot;</span><span class="p">,</span> <span class="n">ylabel</span><span class="o">=</span><span class="s2">&quot;Battery SOC&quot;</span><span class="p">,</span> <span class="n">ylim</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">],</span> <span class="n">xlim</span><span class="o">=</span><span class="p">(</span><span class="n">battery</span><span class="o">.</span><span class="n">start_dt</span><span class="p">,</span> <span class="n">battery</span><span class="o">.</span><span class="n">end_dt</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">(</span><span class="n">rotation</span><span class="o">=</span><span class="mi">45</span><span class="p">)</span>
<span class="n">fig</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
</pre></div>
</div>
<figure class="align-default" id="id7">
<img alt="_images/pyo-emit-battery-soc.png" src="_images/pyo-emit-battery-soc.png" />
<figcaption>
<p><span class="caption-text">Battery state of charge (SOC) as a percentage during our modeling period (July 2022).</span><a class="headerlink" href="#id7" title="Permalink to this image"></a></p>
</figcaption>
</figure>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="optimize_cost.html" class="btn btn-neutral float-left" title="Optimize Electricity Costs" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="cooptimize.html" class="btn btn-neutral float-right" title="Co-optimize Costs and Emissions" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2025, WE3Lab.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>
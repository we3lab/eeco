<!DOCTYPE html>
<html class="writer-html5" lang="en">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>How to Use Advanced Features &mdash; EECO 0.0.5 documentation</title>
      <link rel="stylesheet" type="text/css" href="_static/pygments.css" />
      <link rel="stylesheet" type="text/css" href="_static/css/theme.css" />
      <link rel="stylesheet" type="text/css" href="_static/css/custom.css" />

  
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="_static/jquery.js"></script>
        <script src="_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
        <script src="_static/doctools.js"></script>
        <script src="_static/sphinx_highlight.js"></script>
    <script src="_static/js/theme.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="costs" href="costs.html" />
    <link rel="prev" title="How to Use Flexibility Metrics" href="how_to_metrics.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="index.html" class="icon icon-home">
            EECO
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Overview</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="index.html">Table of Contents</a></li>
<li class="toctree-l1"><a class="reference internal" href="purpose.html">What is the Purpose of this Package?</a></li>
<li class="toctree-l1"><a class="reference internal" href="complexities.html">What Makes Electricity Tariffs so Complex?</a></li>
<li class="toctree-l1"><a class="reference internal" href="why_metrics.html">Why Use Flexibility Metrics?</a></li>
<li class="toctree-l1"><a class="reference internal" href="why_neutral.html">Why Design a Pyomo/CVXPY Neutral Library?</a></li>
<li class="toctree-l1"><a class="reference internal" href="why_advanced.html">Why Do the Advanced Features Exist?</a></li>
<li class="toctree-l1"><a class="reference internal" href="CONTRIBUTING.html">Contributing</a></li>
<li class="toctree-l1"><a class="reference internal" href="LICENSE.html">MIT License</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Tutorials</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="hello.html">Getting Started</a></li>
<li class="toctree-l1"><a class="reference internal" href="optimize_cost.html">Optimize Electricity Costs</a></li>
<li class="toctree-l1"><a class="reference internal" href="optimize_emit.html">Optimize Scope 2 Emissions</a></li>
<li class="toctree-l1"><a class="reference internal" href="cooptimize.html">Co-optimize Costs and Emissions</a></li>
<li class="toctree-l1"><a class="reference internal" href="tutorial_metrics.html">Flexibility Metrics as Constraints</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">How-to Guides</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="data_format.html">How to Format Data</a></li>
<li class="toctree-l1"><a class="reference internal" href="how_to_cost.html">How to Calculate Costs</a></li>
<li class="toctree-l1"><a class="reference internal" href="how_to_emit.html">How to Calculate Emissions</a></li>
<li class="toctree-l1"><a class="reference internal" href="how_to_metrics.html">How to Use Flexibility Metrics</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">How to Use Advanced Features</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#how-to-use-prev-demand-dict-and-prev-consumption-dict">How to Use <cite>prev_demand_dict</cite> and <cite>prev_consumption_dict</cite></a></li>
<li class="toctree-l2"><a class="reference internal" href="#how-to-use-consumption-estimate">How to Use <cite>consumption_estimate</cite></a></li>
<li class="toctree-l2"><a class="reference internal" href="#how-to-use-demand-scale-factor">How to Use <cite>demand_scale_factor</cite></a></li>
<li class="toctree-l2"><a class="reference internal" href="#how-to-use-varstr-alias-func">How to Use <cite>varstr_alias_func</cite></a></li>
</ul>
</li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Code</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="costs.html">costs</a></li>
<li class="toctree-l1"><a class="reference internal" href="emissions.html">emissions</a></li>
<li class="toctree-l1"><a class="reference internal" href="metrics.html">metrics</a></li>
<li class="toctree-l1"><a class="reference internal" href="units.html">units</a></li>
<li class="toctree-l1"><a class="reference internal" href="utils.html">utils</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">EECO</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="index.html" class="icon icon-home" aria-label="Home"></a></li>
      <li class="breadcrumb-item active">How to Use Advanced Features</li>
      <li class="wy-breadcrumbs-aside">
            <a href="_sources/how_to_advanced.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <nav class="contents" id="contents" role="doc-toc">
<p class="topic-title">Contents</p>
<ul class="simple">
<li><p><a class="reference internal" href="#how-to-use-advanced-features" id="id1">How to Use Advanced Features</a></p>
<ul>
<li><p><a class="reference internal" href="#how-to-use-prev-demand-dict-and-prev-consumption-dict" id="id2">How to Use <cite>prev_demand_dict</cite> and <cite>prev_consumption_dict</cite></a></p></li>
<li><p><a class="reference internal" href="#how-to-use-consumption-estimate" id="id3">How to Use <cite>consumption_estimate</cite></a></p></li>
<li><p><a class="reference internal" href="#how-to-use-demand-scale-factor" id="id4">How to Use <cite>demand_scale_factor</cite></a></p></li>
<li><p><a class="reference internal" href="#how-to-use-varstr-alias-func" id="id5">How to Use <cite>varstr_alias_func</cite></a></p></li>
</ul>
</li>
</ul>
</nav>
<section id="how-to-use-advanced-features">
<span id="how-to-advanced"></span><h1><a class="toc-backref" href="#id1" role="doc-backlink">How to Use Advanced Features</a><a class="headerlink" href="#how-to-use-advanced-features" title="Permalink to this heading"></a></h1>
<p>There are a few advanced features that can be used via flags in <cite>calculate_cost</cite>.
These features are particularly useful for moving horizon optimization.
Check out <a class="reference internal" href="why_advanced.html#why-advanced"><span class="std std-ref">Why Do the Advanced Features Exist?</span></a> for more background as to why we recommend moving horizon optimization.</p>
<section id="how-to-use-prev-demand-dict-and-prev-consumption-dict">
<span id="prev-consumption"></span><h2><a class="toc-backref" href="#id2" role="doc-backlink">How to Use <cite>prev_demand_dict</cite> and <cite>prev_consumption_dict</cite></a><a class="headerlink" href="#how-to-use-prev-demand-dict-and-prev-consumption-dict" title="Permalink to this heading"></a></h2>
<p>By default, <cite>prev_demand_dict=None</cite> and <cite>prev_consumption_dict=None</cite>.
However, a user may want to optimize their energy bill starting partway through a billing period.
In this case, it is important to take into account previously consumed electricity when optimizing the electricity bill (<a class="reference internal" href="why_advanced.html#why-prev-consumption"><span class="std std-ref">What Is the Purpose of prev_demand_dict and prev_consumption_dict?</span></a>).</p>
<p>To do so, simply provide the total energy consumption (in kWh, therms, or cubic meters) for each charge string from <cite>costs.get_charge_dict</cite>.
For example, using <cite>billing_pge.csv</cite>:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">eeco</span><span class="w"> </span><span class="kn">import</span> <span class="n">costs</span>

<span class="n">tariff_path</span> <span class="o">=</span> <span class="s2">&quot;tests/data/input/billing_pge.csv&quot;</span>
<span class="n">start_dt</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">datetime64</span><span class="p">(</span><span class="s2">&quot;2024-07-10&quot;</span><span class="p">)</span>
<span class="n">end_dt</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">datetime64</span><span class="p">(</span><span class="s2">&quot;2024-07-11&quot;</span><span class="p">)</span>
<span class="n">billing_data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">tariff_path</span><span class="p">)</span>
<span class="n">charge_dict</span> <span class="o">=</span> <span class="n">costs</span><span class="o">.</span><span class="n">get_charge_dict</span><span class="p">(</span><span class="n">start_dt</span><span class="p">,</span> <span class="n">end_dt</span><span class="p">,</span> <span class="n">billing_data</span><span class="p">)</span>

<span class="c1"># one day of 15-min intervals</span>
<span class="n">num_timesteps</span> <span class="o">=</span> <span class="mi">96</span>

<span class="c1"># this is just a CVXPY variable, but a user would provide constraints to the optimization problem</span>
<span class="n">consumption_data_dict</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;electric&quot;</span><span class="p">:</span> <span class="n">cp</span><span class="o">.</span><span class="n">Variable</span><span class="p">(</span><span class="n">num_timesteps</span><span class="p">),</span> <span class="s2">&quot;gas&quot;</span><span class="p">:</span> <span class="n">cp</span><span class="o">.</span><span class="n">Variable</span><span class="p">(</span><span class="n">num_timesteps</span><span class="p">)}</span>

<span class="n">prev_consumption_dict</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;gas_energy_0_20240710_20240710_0&quot;</span><span class="p">:</span> <span class="mi">960</span><span class="p">,</span>
    <span class="s2">&quot;gas_energy_0_20240710_20240710_5000&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
    <span class="s2">&quot;electric_energy_0_20240710_20240710_0&quot;</span><span class="p">:</span> <span class="mi">34000</span><span class="p">,</span>
    <span class="s2">&quot;electric_energy_1_20240710_20240710_0&quot;</span><span class="p">:</span> <span class="mi">14000</span><span class="p">,</span>
    <span class="s2">&quot;electric_energy_2_20240710_20240710_0&quot;</span><span class="p">:</span> <span class="mi">24000</span><span class="p">,</span>
    <span class="s2">&quot;electric_energy_3_20240710_20240710_0&quot;</span><span class="p">:</span> <span class="mi">14000</span><span class="p">,</span>
    <span class="s2">&quot;electric_energy_4_20240710_20240710_0&quot;</span><span class="p">:</span> <span class="mi">14000</span><span class="p">,</span>
    <span class="s2">&quot;electric_energy_5_20240710_20240710_0&quot;</span><span class="p">:</span> <span class="mi">19200</span><span class="p">,</span>
    <span class="s2">&quot;electric_energy_6_20240710_20240710_0&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
    <span class="s2">&quot;electric_energy_7_20240710_20240710_0&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
    <span class="s2">&quot;electric_energy_8_20240710_20240710_0&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
    <span class="s2">&quot;electric_energy_9_20240710_20240710_0&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
    <span class="s2">&quot;electric_energy_10_20240710_20240710_0&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
    <span class="s2">&quot;electric_energy_11_20240710_20240710_0&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
    <span class="s2">&quot;electric_energy_12_20240710_20240710_0&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
    <span class="s2">&quot;electric_energy_13_20240710_20240710_0&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
<span class="p">}</span>

<span class="c1"># see below sections with more detail on how to define the `consumption_estimate``</span>
<span class="c1"># this is just synthetic data, but a real estimate from the facility historical data should be used</span>
<span class="n">consumption_estimate</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;gas&quot;</span><span class="p">:</span> <span class="nb">sum</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">num_timesteps</span><span class="p">)),</span> <span class="s2">&quot;electric&quot;</span><span class="p">:</span> <span class="nb">sum</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">num_timesteps</span><span class="p">)</span> <span class="o">*</span> <span class="mi">100</span><span class="p">)}</span>

<span class="n">total_monthly_bill</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">costs</span><span class="o">.</span><span class="n">calculate_costs</span><span class="p">(</span>
    <span class="n">charge_dict</span><span class="p">,</span>
    <span class="n">consumption_data_dict</span><span class="p">,</span>
    <span class="n">prev_consumption_dict</span><span class="o">=</span><span class="n">prev_consumption_dict</span><span class="p">,</span>
    <span class="n">consumption_estimate</span><span class="o">=</span><span class="n">consumption_estimate</span>
<span class="p">)</span>
</pre></div>
</div>
</section>
<section id="how-to-use-consumption-estimate">
<span id="consumption-est"></span><h2><a class="toc-backref" href="#id3" role="doc-backlink">How to Use <cite>consumption_estimate</cite></a><a class="headerlink" href="#how-to-use-consumption-estimate" title="Permalink to this heading"></a></h2>
<p>By default <cite>consumption_estimate=0</cite>, meaning that it will be ignored.
This behavior is not an issue for most electricity and natural gas tariffs.
However, if a tariff has charge tiers, then a consumption estimate is required to estimate which tier the customer will be subject to.
There are four different ways to input <cite>consumption_estimate</cite>:</p>
<blockquote>
<div><ul class="simple">
<li><p><cite>dict</cite> of <cite>float</cite>, <cite>int</cite>, or <cite>array</cite> with keys “electric” and “gas”
- Within each dictionary entry, the below rules for <cite>array</cite> and <cite>float</cite>/<cite>int</cite> are followed.</p></li>
<li><p><cite>array</cite>
- If an <cite>array</cite>, the units are assumed to be in power (i.e., kW, therm / hr, or cubic meter / hr).
- The array is converted to kWh, therms, or cubic meters before being passed to <cite>calculate_energy_cost</cite>,
but passed in the original units to <cite>calculate_demand_cost</cite>.</p></li>
<li><p><cite>float</cite> or <cite>int</cite>
- If a <cite>float</cite> or <cite>int</cite>, the units are assumed to be in energy (i.e., kWh, therms, or cubic meters).
- The <cite>consumption_estimate</cite> is divided by the number of timesteps in the simulation to estimate the maximum consumption
that is passed into <cite>calculate_demand_cost</cite>.</p></li>
</ul>
</div></blockquote>
<p>Here are examples of each method in code, assuming that tariff data has already been loaded as <cite>tariff_df</cite>:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">eeco</span><span class="w"> </span><span class="kn">import</span> <span class="n">costs</span>

<span class="c1"># load necessary data</span>
<span class="n">start_dt</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">datetime64</span><span class="p">(</span><span class="s2">&quot;2024-07-10&quot;</span><span class="p">)</span>
<span class="n">end_dt</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">datetime64</span><span class="p">(</span><span class="s2">&quot;2024-07-11&quot;</span><span class="p">)</span>
<span class="n">charge_dict</span> <span class="o">=</span> <span class="n">costs</span><span class="o">.</span><span class="n">get_charge_dict</span><span class="p">(</span><span class="n">start_dt</span><span class="p">,</span> <span class="n">end_dt</span><span class="p">,</span> <span class="n">tariff_df</span><span class="p">)</span>
<span class="n">num_timesteps</span> <span class="o">=</span> <span class="mi">96</span>

<span class="c1"># this is just a CVXPY variable, but a user would provide constraints to the optimization problem</span>
<span class="n">consumption_data_dict</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;electric&quot;</span><span class="p">:</span> <span class="n">cp</span><span class="o">.</span><span class="n">Variable</span><span class="p">(</span><span class="n">num_timesteps</span><span class="p">),</span> <span class="s2">&quot;gas&quot;</span><span class="p">:</span> <span class="n">cp</span><span class="o">.</span><span class="n">Variable</span><span class="p">(</span><span class="n">num_timesteps</span><span class="p">)}</span>

<span class="c1"># `consumptione_estimate` as a dict of floats and/or arrays</span>
<span class="n">total_monthly_bill</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">costs</span><span class="o">.</span><span class="n">calculate_costs</span><span class="p">(</span>
    <span class="n">charge_dict</span><span class="p">,</span>
    <span class="n">consumption_data_dict</span><span class="p">,</span>
    <span class="n">consumption_estimate</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;gas&quot;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">num_timesteps</span><span class="p">),</span> <span class="s2">&quot;electric&quot;</span><span class="p">:</span> <span class="nb">sum</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">num_timesteps</span><span class="p">)</span> <span class="o">*</span> <span class="mi">100</span><span class="p">)}</span>
<span class="p">)</span>

<span class="c1"># `consumptione_estimate` as an array</span>
<span class="n">total_monthly_bill</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">costs</span><span class="o">.</span><span class="n">calculate_costs</span><span class="p">(</span>
    <span class="n">charge_dict</span><span class="p">,</span>
    <span class="n">consumption_data_dict</span><span class="p">,</span>
    <span class="n">consumption_estimate</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">num_timesteps</span><span class="p">),</span>
    <span class="n">desired_utility</span><span class="o">=</span><span class="s2">&quot;gas&quot;</span>
<span class="p">)</span>

<span class="c1"># `consumptione_estimate` as a float or int</span>
<span class="n">total_monthly_bill</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">costs</span><span class="o">.</span><span class="n">calculate_costs</span><span class="p">(</span>
    <span class="n">charge_dict</span><span class="p">,</span>
    <span class="n">consumption_data_dict</span><span class="p">,</span>
    <span class="n">consumption_estimate</span><span class="o">=</span><span class="nb">sum</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">num_timesteps</span><span class="p">)</span> <span class="o">*</span> <span class="mi">100</span><span class="p">),</span>
    <span class="n">desired_utility</span><span class="o">=</span><span class="s2">&quot;electric&quot;</span>
<span class="p">)</span>
</pre></div>
</div>
<p>Note that consumption estimate is for the simulation period only since <a class="reference internal" href="#prev-consumption"><span class="std std-ref">How to Use prev_demand_dict and prev_consumption_dict</span></a> will take into account
the previous consumption during this billing period in conjunction with <cite>consumption_estimate</cite> to estimate the charge tier.</p>
</section>
<section id="how-to-use-demand-scale-factor">
<span id="scale-demand"></span><h2><a class="toc-backref" href="#id4" role="doc-backlink">How to Use <cite>demand_scale_factor</cite></a><a class="headerlink" href="#how-to-use-demand-scale-factor" title="Permalink to this heading"></a></h2>
<p>By default <cite>demand_scale_factor=1</cite>, meaning that there will be no modifications applied to the demand or energy charges.
The purpose of the scale factor is to modify the demand charges proportional to energy charges when performing moving horizon optimization.</p>
<p>There are various heuristics that could be used to calculate the scale factor (see <a class="reference internal" href="why_advanced.html#why-scale-demand"><span class="std std-ref">What Is the Purpose of demand_scale_factor?</span></a>),
but for now let’s assume that we just want to scale the demand charge down by the length of the horizon window proportional to billing period.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">eeco</span><span class="w"> </span><span class="kn">import</span> <span class="n">costs</span>

<span class="c1"># load necessary data</span>
<span class="n">start_dt</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">datetime64</span><span class="p">(</span><span class="s2">&quot;2024-07-10&quot;</span><span class="p">)</span>
<span class="n">end_dt</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">datetime64</span><span class="p">(</span><span class="s2">&quot;2024-07-11&quot;</span><span class="p">)</span>
<span class="n">charge_dict</span> <span class="o">=</span> <span class="n">costs</span><span class="o">.</span><span class="n">get_charge_dict</span><span class="p">(</span><span class="n">start_dt</span><span class="p">,</span> <span class="n">end_dt</span><span class="p">,</span> <span class="n">tariff_df</span><span class="p">)</span>
<span class="n">num_timesteps_horizon</span> <span class="o">=</span> <span class="mi">96</span>
<span class="n">num_timesteps_billing</span> <span class="o">=</span> <span class="mi">96</span> <span class="o">*</span> <span class="mi">31</span>

<span class="c1"># this is just a CVXPY variable, but a user would provide constraints to the optimization problem</span>
<span class="n">consumption_data_dict</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;electric&quot;</span><span class="p">:</span> <span class="n">cp</span><span class="o">.</span><span class="n">Variable</span><span class="p">(</span><span class="n">num_timesteps</span><span class="p">),</span> <span class="s2">&quot;gas&quot;</span><span class="p">:</span> <span class="n">cp</span><span class="o">.</span><span class="n">Variable</span><span class="p">(</span><span class="n">num_timesteps</span><span class="p">)}</span>

<span class="n">total_monthly_bill</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">costs</span><span class="o">.</span><span class="n">calculate_costs</span><span class="p">(</span>
    <span class="n">charge_dict</span><span class="p">,</span>
    <span class="n">consumption_data_dict</span><span class="p">,</span>
    <span class="n">demand_scale_factor</span><span class="o">=</span><span class="n">num_timesteps_horizon</span><span class="o">/</span><span class="n">num_timesteps_billing</span>
<span class="p">)</span>
</pre></div>
</div>
</section>
<section id="how-to-use-varstr-alias-func">
<span id="varstr-alias"></span><h2><a class="toc-backref" href="#id5" role="doc-backlink">How to Use <cite>varstr_alias_func</cite></a><a class="headerlink" href="#how-to-use-varstr-alias-func" title="Permalink to this heading"></a></h2>
<p>The software creates new variables when building the optimization problem.
At times, users want control over what variable names are assigned to the new variables.
By default, <cite>default_varstr_alias_func</cite> creates variable names of the following format:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">default_varstr_alias_func</span><span class="p">(</span>
    <span class="n">utility</span><span class="p">,</span> <span class="n">charge_type</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">start_date</span><span class="p">,</span> <span class="n">end_date</span><span class="p">,</span> <span class="n">charge_limit</span>
<span class="p">):</span>
    <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">utility</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">charge_type</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">start_date</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">end_date</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">charge_limit</span><span class="si">}</span><span class="s2">&quot;</span>
</pre></div>
</div>
<p>However, users can pass in their own custom variable name function into <cite>calculate_costs</cite>.
For example, to change “gas” to “ng” in all the variable names:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">eeco</span><span class="w"> </span><span class="kn">import</span> <span class="n">costs</span>

<span class="k">def</span><span class="w"> </span><span class="nf">custom_varstr_alias_func</span><span class="p">(</span>
    <span class="n">utility</span><span class="p">,</span> <span class="n">charge_type</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">start_date</span><span class="p">,</span> <span class="n">end_date</span><span class="p">,</span> <span class="n">charge_limit</span>
<span class="p">):</span>
    <span class="k">if</span> <span class="n">utility</span> <span class="o">==</span> <span class="s2">&quot;gas&quot;</span><span class="p">:</span>
        <span class="n">utility</span> <span class="o">=</span> <span class="s2">&quot;ng&quot;</span>
    <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">utility</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">charge_type</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">start_date</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">end_date</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">charge_limit</span><span class="si">}</span><span class="s2">&quot;</span>

<span class="c1"># load necessary data</span>
<span class="n">start_dt</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">datetime64</span><span class="p">(</span><span class="s2">&quot;2024-07-10&quot;</span><span class="p">)</span>
<span class="n">end_dt</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">datetime64</span><span class="p">(</span><span class="s2">&quot;2024-07-11&quot;</span><span class="p">)</span>
<span class="n">charge_dict</span> <span class="o">=</span> <span class="n">costs</span><span class="o">.</span><span class="n">get_charge_dict</span><span class="p">(</span><span class="n">start_dt</span><span class="p">,</span> <span class="n">end_dt</span><span class="p">,</span> <span class="n">tariff_df</span><span class="p">)</span>
<span class="n">num_timesteps_horizon</span> <span class="o">=</span> <span class="mi">96</span>

<span class="c1"># this is just a CVXPY variable, but a user would provide constraints to the optimization problem</span>
<span class="n">consumption_data_dict</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;electric&quot;</span><span class="p">:</span> <span class="n">cp</span><span class="o">.</span><span class="n">Variable</span><span class="p">(</span><span class="n">num_timesteps</span><span class="p">),</span> <span class="s2">&quot;gas&quot;</span><span class="p">:</span> <span class="n">cp</span><span class="o">.</span><span class="n">Variable</span><span class="p">(</span><span class="n">num_timesteps</span><span class="p">)}</span>

<span class="n">total_monthly_bill</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">costs</span><span class="o">.</span><span class="n">calculate_costs</span><span class="p">(</span>
    <span class="n">charge_dict</span><span class="p">,</span>
    <span class="n">consumption_data_dict</span><span class="p">,</span>
    <span class="n">varstr_alias_func</span><span class="o">=</span><span class="n">custom_varstr_alias_func</span><span class="p">,</span>
<span class="p">)</span>
</pre></div>
</div>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="how_to_metrics.html" class="btn btn-neutral float-left" title="How to Use Flexibility Metrics" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="costs.html" class="btn btn-neutral float-right" title="costs" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2025, WE3Lab.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>
<!DOCTYPE html>
<html class="writer-html5" lang="en">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Why Do the Advanced Features Exist? &mdash; EECO 0.1.0 documentation</title>
      <link rel="stylesheet" type="text/css" href="_static/pygments.css" />
      <link rel="stylesheet" type="text/css" href="_static/css/theme.css" />
      <link rel="stylesheet" type="text/css" href="_static/css/custom.css" />

  
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="_static/jquery.js"></script>
        <script src="_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
        <script src="_static/doctools.js"></script>
        <script src="_static/sphinx_highlight.js"></script>
    <script src="_static/js/theme.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Contributing" href="CONTRIBUTING.html" />
    <link rel="prev" title="Why Design a Pyomo/CVXPY Neutral Library?" href="why_neutral.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="index.html" class="icon icon-home">
            EECO
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Overview</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="index.html">Table of Contents</a></li>
<li class="toctree-l1"><a class="reference internal" href="purpose.html">What is the Purpose of this Package?</a></li>
<li class="toctree-l1"><a class="reference internal" href="complexities.html">What Makes Electricity Tariffs so Complex?</a></li>
<li class="toctree-l1"><a class="reference internal" href="why_metrics.html">Why Use Flexibility Metrics?</a></li>
<li class="toctree-l1"><a class="reference internal" href="why_neutral.html">Why Design a Pyomo/CVXPY Neutral Library?</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Why Do the Advanced Features Exist?</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#why-use-moving-horizon-optimization">Why Use Moving Horizon Optimization?</a></li>
<li class="toctree-l2"><a class="reference internal" href="#what-is-the-purpose-of-prev-demand-dict-and-prev-consumption-dict">What Is the Purpose of <cite>prev_demand_dict</cite> and <cite>prev_consumption_dict</cite>?</a></li>
<li class="toctree-l2"><a class="reference internal" href="#what-is-the-purpose-of-consumption-estimate">What Is the Purpose of <cite>consumption_estimate</cite>?</a></li>
<li class="toctree-l2"><a class="reference internal" href="#what-is-the-purpose-of-demand-scale-factor">What Is the Purpose of <cite>demand_scale_factor</cite>?</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="CONTRIBUTING.html">Contributing</a></li>
<li class="toctree-l1"><a class="reference internal" href="LICENSE.html">MIT License</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Tutorials</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="hello.html">Getting Started</a></li>
<li class="toctree-l1"><a class="reference internal" href="optimize_cost.html">Optimize Electricity Costs</a></li>
<li class="toctree-l1"><a class="reference internal" href="optimize_emit.html">Optimize Scope 2 Emissions</a></li>
<li class="toctree-l1"><a class="reference internal" href="cooptimize.html">Co-optimize Costs and Emissions</a></li>
<li class="toctree-l1"><a class="reference internal" href="tutorial_metrics.html">Flexibility Metrics as Constraints</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">How-to Guides</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="data_format.html">How to Format Data</a></li>
<li class="toctree-l1"><a class="reference internal" href="how_to_cost.html">How to Calculate Costs</a></li>
<li class="toctree-l1"><a class="reference internal" href="how_to_emit.html">How to Calculate Emissions</a></li>
<li class="toctree-l1"><a class="reference internal" href="how_to_metrics.html">How to Use Flexibility Metrics</a></li>
<li class="toctree-l1"><a class="reference internal" href="how_to_advanced.html">How to Use Advanced Features</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Code</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="costs.html">costs</a></li>
<li class="toctree-l1"><a class="reference internal" href="emissions.html">emissions</a></li>
<li class="toctree-l1"><a class="reference internal" href="metrics.html">metrics</a></li>
<li class="toctree-l1"><a class="reference internal" href="units.html">units</a></li>
<li class="toctree-l1"><a class="reference internal" href="utils.html">utils</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">EECO</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="index.html" class="icon icon-home" aria-label="Home"></a></li>
      <li class="breadcrumb-item active">Why Do the Advanced Features Exist?</li>
      <li class="wy-breadcrumbs-aside">
            <a href="_sources/why_advanced.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <nav class="contents" id="contents" role="doc-toc">
<p class="topic-title">Contents</p>
<ul class="simple">
<li><p><a class="reference internal" href="#why-do-the-advanced-features-exist" id="id1">Why Do the Advanced Features Exist?</a></p>
<ul>
<li><p><a class="reference internal" href="#why-use-moving-horizon-optimization" id="id2">Why Use Moving Horizon Optimization?</a></p></li>
<li><p><a class="reference internal" href="#what-is-the-purpose-of-prev-demand-dict-and-prev-consumption-dict" id="id3">What Is the Purpose of <cite>prev_demand_dict</cite> and <cite>prev_consumption_dict</cite>?</a></p></li>
<li><p><a class="reference internal" href="#what-is-the-purpose-of-consumption-estimate" id="id4">What Is the Purpose of <cite>consumption_estimate</cite>?</a></p></li>
<li><p><a class="reference internal" href="#what-is-the-purpose-of-demand-scale-factor" id="id5">What Is the Purpose of <cite>demand_scale_factor</cite>?</a></p></li>
</ul>
</li>
</ul>
</nav>
<section id="why-do-the-advanced-features-exist">
<span id="why-advanced"></span><h1><a class="toc-backref" href="#id1" role="doc-backlink">Why Do the Advanced Features Exist?</a><a class="headerlink" href="#why-do-the-advanced-features-exist" title="Permalink to this heading"></a></h1>
<p>We know that the “advanced features” outlined in <a class="reference internal" href="how_to_advanced.html#how-to-advanced"><span class="std std-ref">How to Use Advanced Features</span></a> may be unintuitive,
so we assure you that we had very good reasons for writing each of them.</p>
<p>Most of the advanced features are designed to handle the peculiarities of computing a monthly electricity bill
in a time window of only a few days for moving horizon optmization.</p>
<section id="why-use-moving-horizon-optimization">
<span id="why-moving-horizon"></span><h2><a class="toc-backref" href="#id2" role="doc-backlink">Why Use Moving Horizon Optimization?</a><a class="headerlink" href="#why-use-moving-horizon-optimization" title="Permalink to this heading"></a></h2>
<p>We believe the two main benefits to moving horizon optimization are (1) computational complexity and (2) avoiding perfect foresight.</p>
<p>Sometimes running optimization for an entire billing period (usually a month) at the necessary control intervals is computationally infeasible.
In those cases, moving horizon optimization allows an analyst to define a sliding window (the horizon period) and step through the entire billing period sequentially.</p>
<p>Even when computationally feasible, running an entire billing period may be undesirable because it provides too much foresight to the model.
Moving horizon optimization can be used to realistically simulated model-predictive control (MPC),
which ensures that the benefits of improved control strategies are correctly quantified.</p>
</section>
<section id="what-is-the-purpose-of-prev-demand-dict-and-prev-consumption-dict">
<span id="why-prev-consumption"></span><h2><a class="toc-backref" href="#id3" role="doc-backlink">What Is the Purpose of <cite>prev_demand_dict</cite> and <cite>prev_consumption_dict</cite>?</a><a class="headerlink" href="#what-is-the-purpose-of-prev-demand-dict-and-prev-consumption-dict" title="Permalink to this heading"></a></h2>
<p>When performing moving horizon optimization, we need to know the previous consumption and costs from within the same billing period.
For example, if I have already hit 100 kW of peak demand, then going up to 99 kW will not add any cost to the demand charge on my bill.</p>
<p>Both <cite>prev_demand_dict</cite> and <cite>prev_consumption_dict</cite> are necessary due to the complexity of the tariffs.
For some demand charges there are different costs at different times, so we cannot just use the <cite>prev_consumption_dict</cite> directly to compute
the previous maximum charge billed.</p>
</section>
<section id="what-is-the-purpose-of-consumption-estimate">
<span id="why-consumption-est"></span><h2><a class="toc-backref" href="#id4" role="doc-backlink">What Is the Purpose of <cite>consumption_estimate</cite>?</a><a class="headerlink" href="#what-is-the-purpose-of-consumption-estimate" title="Permalink to this heading"></a></h2>
<p>If a utility uses tiered charges, then the price per unit of electricity varies depending on total monthly consumption (<a class="reference internal" href="complexities.html#complexities"><span class="std std-ref">What Makes Electricity Tariffs so Complex?</span></a>).
This means that the correct tier is a function of the monthly electricity consumption profile, which is a variable in the optimization problem.
This makes computing the cost of electricity directly non-convex,
so we assume the total monthly consumption using the <cite>consumption_estimate</cite> flag to simplify the problem into a convex form.
Moving horizon optimization omplicates this issue even further, since the total monthly consumption will not be known in a single time window.</p>
<p>We have found that the convex simplification works quite well in our energy flexibility research since the timing but not magnitude of electricity consumption changes between simulations.
However, in other applications this convex approxmiation may not fare as well.</p>
</section>
<section id="what-is-the-purpose-of-demand-scale-factor">
<span id="why-scale-demand"></span><h2><a class="toc-backref" href="#id5" role="doc-backlink">What Is the Purpose of <cite>demand_scale_factor</cite>?</a><a class="headerlink" href="#what-is-the-purpose-of-demand-scale-factor" title="Permalink to this heading"></a></h2>
<p>The demand scale factor was designed in our academic papers to balance demand and energy charges during moving horizon optimization.</p>
<p>The basic concept is that the certainty around demand charges and therefore relative weight between demand and energy charges
varies throughout the month. In other words, as time goes on the demand charge becomes more certain and should be given a higher weight.</p>
<p>The specific mathematical formulation that we recommend is as follows, but the scale factor should be tuned for each application
by adjusting <cite>lambda_energy</cite>:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">n_billing</span> <span class="o">=</span> <span class="mi">4</span>  <span class="c1"># number of days in the horizon window</span>
<span class="n">n_horizon</span> <span class="o">=</span> <span class="mi">31</span>  <span class="c1"># number of days in the billing period</span>
<span class="n">lambda_energy</span> <span class="o">=</span> <span class="mf">0.7</span>  <span class="c1"># tunable parameter</span>
<span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_billing</span><span class="p">):</span>
    <span class="n">energy_scale_factor</span> <span class="o">=</span> <span class="n">lambda_energy</span> <span class="o">*</span> <span class="p">(</span><span class="n">n_billing</span> <span class="o">-</span> <span class="n">d</span><span class="p">)</span> <span class="o">/</span> <span class="n">n_horizon</span>
    <span class="n">demand_scale_factor</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">/</span> <span class="n">energy_scale_factor</span>
</pre></div>
</div>
<p>You can read more about this concept in “Integrated energy flexibility management at wastewater treatment facilities” [<a class="reference external" href="https://doi.org/10.1021/acs.est.3c00365">Bolorinos 𝐸𝑛𝑣𝑖𝑟𝑜𝑛. 𝑆𝑐𝑖. 𝑇𝑒𝑐ℎ𝑛𝑜𝑙. (2023)</a>]
and “Load-Shifting Strategies for Cost-Effective Emission Reductions at Wastewater Facilities” [<a class="reference external" href="https://doi.org/10.1021/acs.est.4c09773">Chapin 𝐸𝑛𝑣𝑖𝑟𝑜𝑛. 𝑆𝑐𝑖. 𝑇𝑒𝑐ℎ𝑛𝑜𝑙. (2025)</a>].</p>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="why_neutral.html" class="btn btn-neutral float-left" title="Why Design a Pyomo/CVXPY Neutral Library?" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="CONTRIBUTING.html" class="btn btn-neutral float-right" title="Contributing" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2025, WE3Lab.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>